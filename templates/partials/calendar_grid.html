<div class="card bg-base-200 shadow-lg">
    <div class="card-body p-3 sm:p-6">
        <div class="flex flex-col gap-4 mb-6">
            <div class="flex items-center justify-between">
                <a hx-get="{{ url_for('production_calendar', year=prev_year, month=prev_month, job_id=job_filter) }}" 
                   hx-target="#calendar-container" hx-swap="innerHTML"
                   class="btn btn-ghost btn-sm" data-testid="button-prev-month">
                    <i class="fas fa-chevron-left"></i>
                </a>
                <h2 class="text-lg sm:text-xl font-bold">{{ calendar.month_name[month] }} {{ year }}</h2>
                <a hx-get="{{ url_for('production_calendar', year=next_year, month=next_month, job_id=job_filter) }}" 
                   hx-target="#calendar-container" hx-swap="innerHTML"
                   class="btn btn-ghost btn-sm" data-testid="button-next-month">
                    <i class="fas fa-chevron-right"></i>
                </a>
            </div>
            
            <div class="flex flex-col sm:flex-row sm:items-center gap-2">
                <span class="text-sm text-base-content/60">Filter by job:</span>
                <select hx-get="{{ url_for('production_calendar', year=year, month=month) }}" 
                        hx-target="#calendar-container" hx-swap="innerHTML"
                        hx-trigger="change"
                        hx-include="this"
                        name="job_id"
                        class="select select-bordered select-sm bg-base-300/50 w-full sm:w-auto" data-testid="select-job-filter">
                    <option value="">All Jobs</option>
                    {% for job in jobs %}
                    <option value="{{ job.id }}" {% if job_filter|string == job.id|string %}selected{% endif %}>
                        {{ job.display_title }} ({{ job.client.name }})
                    </option>
                    {% endfor %}
                </select>
            </div>
        </div>
        
        <div class="overflow-x-auto -mx-3 sm:mx-0">
            <table class="table w-full">
                <thead>
                    <tr>
                        <th class="text-center w-1/7 text-base-content/60 text-xs sm:text-sm p-1 sm:p-2">Sun</th>
                        <th class="text-center w-1/7 text-base-content/60 text-xs sm:text-sm p-1 sm:p-2">Mon</th>
                        <th class="text-center w-1/7 text-base-content/60 text-xs sm:text-sm p-1 sm:p-2">Tue</th>
                        <th class="text-center w-1/7 text-base-content/60 text-xs sm:text-sm p-1 sm:p-2">Wed</th>
                        <th class="text-center w-1/7 text-base-content/60 text-xs sm:text-sm p-1 sm:p-2">Thu</th>
                        <th class="text-center w-1/7 text-base-content/60 text-xs sm:text-sm p-1 sm:p-2">Fri</th>
                        <th class="text-center w-1/7 text-base-content/60 text-xs sm:text-sm p-1 sm:p-2">Sat</th>
                    </tr>
                </thead>
                <tbody>
                    {% for week in month_days %}
                    <tr>
                        {% for day in week %}
                        <td class="align-top p-0.5 sm:p-1 h-16 sm:h-24 border border-base-300">
                            {% if day != 0 %}
                            <div class="p-1">
                                <span class="text-sm font-medium {% if today.year == year and today.month == month and today.day == day %}badge badge-primary badge-sm{% endif %}">
                                    {{ day }}
                                </span>
                                
                                {% if day in deliverables_by_date %}
                                <div class="mt-1 space-y-1">
                                    {% for deliverable in deliverables_by_date[day][:3] %}
                                    <a href="{{ url_for('job_detail', job_id=deliverable.job_id) }}" 
                                       class="block text-xs p-1 rounded truncate 
                                              {% if deliverable.status == 'Done' %}bg-success/20 text-success
                                              {% elif deliverable.status == 'Review' %}bg-warning/20 text-warning
                                              {% elif deliverable.status == 'In Progress' %}bg-info/20 text-info
                                              {% else %}bg-base-300 text-base-content/70{% endif %}"
                                       title="{{ deliverable.title }}"
                                       data-testid="calendar-item-{{ deliverable.id }}">
                                        {{ deliverable.title }}
                                    </a>
                                    {% endfor %}
                                    {% if deliverables_by_date[day]|length > 3 %}
                                    <span class="text-xs text-base-content/50">+{{ deliverables_by_date[day]|length - 3 }} more</span>
                                    {% endif %}
                                </div>
                                {% endif %}
                            </div>
                            {% endif %}
                        </td>
                        {% endfor %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        
        <div class="mt-6 flex flex-wrap gap-4 text-sm">
            <div class="flex items-center gap-2">
                <div class="w-3 h-3 rounded bg-base-300"></div>
                <span class="text-base-content/60">To Do</span>
            </div>
            <div class="flex items-center gap-2">
                <div class="w-3 h-3 rounded bg-info/50"></div>
                <span class="text-base-content/60">In Progress</span>
            </div>
            <div class="flex items-center gap-2">
                <div class="w-3 h-3 rounded bg-warning/50"></div>
                <span class="text-base-content/60">Review</span>
            </div>
            <div class="flex items-center gap-2">
                <div class="w-3 h-3 rounded bg-success/50"></div>
                <span class="text-base-content/60">Done</span>
            </div>
        </div>
    </div>
</div>
